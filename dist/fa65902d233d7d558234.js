import*as THREE from"./node_modules/three/build/three.module.js";import{OrbitControls}from"./node_modules/three/examples/jsm/controls/OrbitControls.js";import{STLExporter}from"./node_modules/three/examples/jsm/exporters/STLExporter.js";import{d0,d1,d2,d3,d4}from"./daneWarstwy.js";let scene,camera,renderer,controls,layerSpacing=1,scale=2;const colorRangeSlider=document.getElementById("colorRange");let selectedHueRange=parseFloat(colorRangeSlider.value);function getMaxVal(e){let a=-1/0;for(let n=0;n<e.length;n++)for(let t=0;t<e[n].length;t++)e[n][t]>a&&(a=e[n][t]);return a}function clearScene(){for(let e=scene.children.length-1;e>=0;e--){const a=scene.children[e];a instanceof THREE.Mesh&&(a.geometry.dispose(),a.material.dispose(),scene.remove(a))}}function saveString(e,a){const n=new Blob([e],{type:"text/plain"}),t=document.createElement("a");t.href=URL.createObjectURL(n),t.download=a,t.click()}function addDataToScene(e,a){const n=getMaxVal(e)/4,t=new THREE.SphereGeometry(.5,8,8),o=new Float32Array(3*t.attributes.position.count);for(let e=0;e<o.length;e+=3)o[e]=1,o[e+1]=1,o[e+2]=1;t.setAttribute("color",new THREE.BufferAttribute(o,3));const d=new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}),c=e.length*e[0].length*4,r=new THREE.InstancedMesh(t,d,c);let l=0;for(let t=0;t<e.length;t++)for(let o=0;o<e[t].length;o++){if(o<9||o>58||t<3||t>30)continue;const d=Math.floor(e[t][o]/n);if(!(e[t][o]>.66))for(let e=d;e<4;e++){const n=new THREE.Matrix4;n.setPosition(2*o,2*t,e*layerSpacing+a),r.setMatrixAt(l,n);const d=selectedHueRange+a/(5*scale)*(selectedHueRange+.25-selectedHueRange),c=new THREE.Color;c.setHSL(d,1,.5),r.setColorAt(l,c),l++}}scene.add(r)}function init(){scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),camera.position.set(50,-200,-300),camera.lookAt(scene.position),renderer=new THREE.WebGLRenderer({antialias:!0}),renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(renderer.domElement),controls=new OrbitControls(camera,renderer.domElement),addDataToScene(d4,1*scale),addDataToScene(d3,2*scale),addDataToScene(d2,3*scale),addDataToScene(d1,4*scale),addDataToScene(d0,5*scale),animate()}function animate(){requestAnimationFrame(animate),controls.update(),renderer.render(scene,camera)}colorRangeSlider.addEventListener("input",(function(){selectedHueRange=parseFloat(this.value),clearScene(),addDataToScene(d4,1*scale),addDataToScene(d3,2*scale),addDataToScene(d2,3*scale),addDataToScene(d1,4*scale),addDataToScene(d0,5*scale)})),document.getElementById("minusSpacing").addEventListener("click",(function(){clearScene(),scale+=5,addDataToScene(d4,1*scale),addDataToScene(d3,2*scale),addDataToScene(d2,3*scale),addDataToScene(d1,4*scale),addDataToScene(d0,5*scale)})),document.getElementById("plusSpacing").addEventListener("click",(function(){clearScene(),scale-=5,addDataToScene(d4,1*scale),addDataToScene(d3,2*scale),addDataToScene(d2,3*scale),addDataToScene(d1,4*scale),addDataToScene(d0,5*scale)})),init();